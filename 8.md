# 物化视图
1.查询熔断
避免个别查询慢引起服务血崩，除了单表设置超时外，配置周期熔断，一个查询周期内，用户频繁进行慢查询超出指定阈值后无法继续操作
2.关闭虚拟内存
物理内存和虚拟内存交换，导致查询变慢，资源够就关
3.配置join_use_nulls
为每一个账户添加配置join_use_nulls，在表一条记录在右表不存在返回默认值，不能为null
4.**批量写入时先排序**
批量写时，必须控制每个批次数据涉及分区数量，在写前排序，无序数据涉及分区多，导致clickhouse无法及时对导入数据进行合并，随机io
5 cpu经常关注
50%左右会出现查询波动，70%会出现大范围查询超时

# join
1.用in代替join
当多表联查时，查询数据仅从其中一张表出时，考虑子查询 in
2.大小表join
满足小表右
3.查询谓词记得下推
join查询过程中不会主动发起谓词下推，需要在每个子查询提前完成过滤操作，请参考explain实验
4.分布式表global
两张分布式表上in join前必须加上global，避免查询放大
没有global情况每个节点单独发起一次对右表查询，而右表又是分布式表，导致右表一共被查询n平方次
5.使用字典表
将一些需要关联分析业务创建字典表进行join，不宜过大，字典表常驻内存
6.提前过滤
增加逻辑提前减少数据扫描，降低join消耗内存
